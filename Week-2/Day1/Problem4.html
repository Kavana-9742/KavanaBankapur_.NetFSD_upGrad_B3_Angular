<!DOCTYPE html>
<html>
<head>
    <title>Mini Expense Tracker</title>
</head>
<body>

    <h2>ðŸ’° Mini Expense Tracker</h2>

    <label>Title:</label><br>
    <input type="text" id="title"><br><br>

    <label>Amount:</label><br>
    <input type="number" id="amount"><br><br>

    <label>Date:</label><br>
    <input type="date" id="date"><br><br>

    <button onclick="addExpense()">Add Expense</button>
    <button onclick="viewExpenses()">View Expenses</button>

    <h3>Expense List:</h3>
    <ul id="expenseList"></ul>

    <script>

    let db;

    let request = indexedDB.open("ExpenseDB", 1);

    request.onupgradeneeded = function(event) {
        let database = event.target.result;

        if (!database.objectStoreNames.contains("expenses")) {
            database.createObjectStore("expenses", { keyPath: "id", autoIncrement: true });
        }
    };

    request.onsuccess = function(event) {
        db = event.target.result;
        console.log("Database opened successfully");
    };

    request.onerror = function(event) {
        alert("Database Error: " + event.target.error);
    };

    function addExpense() {

        if (!db) {
            alert("Database not ready yet!");
            return;
        }

        let title = document.getElementById("title").value;
        let amount = document.getElementById("amount").value;
        let date = document.getElementById("date").value;

        if (title === "" || amount === "" || date === "") {
            alert("Please fill all fields!");
            return;
        }

        let transaction = db.transaction("expenses", "readwrite");
        let store = transaction.objectStore("expenses");

        let expense = {
            title: title,
            amount: amount,
            date: date
        };

        store.add(expense);

        transaction.oncomplete = function() {
            alert("Expense Added Successfully!");
            viewExpenses();
        };

        transaction.onerror = function() {
            alert("Transaction Failed!");
        };
    }

    function viewExpenses() {

        if (!db) {
            alert("Database not ready yet!");
            return;
        }

        let transaction = db.transaction("expenses", "readonly");
        let store = transaction.objectStore("expenses");

        let request = store.getAll();

        request.onsuccess = function() {

            let list = document.getElementById("expenseList");
            list.innerHTML = "";

            request.result.forEach(function(item) {

                let li = document.createElement("li");

                li.innerHTML =
                    item.title + " - â‚¹" + item.amount + " - " + item.date +
                    " <button onclick='deleteExpense(" + item.id + ")'>Delete</button>";

                list.appendChild(li);
            });
        };
    }

    function deleteExpense(id) {

        let transaction = db.transaction("expenses", "readwrite");
        let store = transaction.objectStore("expenses");

        store.delete(id);

        transaction.oncomplete = function() {
            viewExpenses();
        };
    }

    </script>

</body>
</html>
